service: my-mern-app   # Change this to your project name (no spaces)

provider:
  name: aws
  runtime: nodejs20.x  # Check your version with "node -v", use 18 or 20
  region: us-east-1
  memorySize: 512       # 512MB RAM for your function
  timeout: 15           # 15 seconds max per request
  environment:
    MONGO_URI: ${env:MONGO_URI}
    GEMINI_API_KEY: ${env:GEMINI_API_KEY}
    CLOUDINARY_CLOUD_NAME: ${env:CLOUDINARY_CLOUD_NAME}
    CLOUDINARY_API_KEY: ${env:CLOUDINARY_API_KEY}
    CLOUDINARY_API_SECRET: ${env:CLOUDINARY_API_SECRET}
    # Add any other variables your app needs
    # NODE_ENV: "production"

functions:
  api:
    handler: main.handler   # "main" = your filename, "handler" = export name
    events:
      - http:
          path: /           # Handles the root route
          method: ANY
      - http:
          path: /{proxy+}   # Handles ALL other routes like /login, /users etc
          method: ANY

package:
  patterns:
    - '!node_modules/.cache/**'   # Don't upload cache
    - '!uploads/**'               # Don't upload uploads folder
    - '!.git/**'                  # Don't upload git history
    - '!.env'                     # Don't upload .env (you put vars above)